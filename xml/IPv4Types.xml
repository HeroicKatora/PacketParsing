<?xml version="1.1" encoding="UTF-8"?>
<!DOCTYPE project>
<gpp:pacparse xmlns="http://github.com/HeroicKatora/PacketParsing" 
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	xmlns:gpp="http://github.com/HeroicKatora/PacketParsing"
	xmlns:std="http://github.com/HeroicKatora/PacketParsing/Standard"
	xsi:schemaLocation="http://github.com/HeroicKatora/PacketParsing PacketSchema
						http://github.com/HeroicKatora/PacketParsing/Standard StandardTypes">
	
	<gpp:import module="gpp.standard">
		<gpp:instantiator_import instance_name="ipVersion" name="IP_Version_Fictional"/>
		<gpp:instantiator_import instance_name="ipTOS" name="IP_TOS"/>
		<gpp:instantiator_import instance_name="ipID" name="IP_ID"/>
		<gpp:instantiator_import instance_name="ipChecksum" name="IP_Checksum"/>
	</gpp:import>
	
	<gpp:include source_document="StandardDocument">
		<gpp:type_include instance_name="integral" name="integral"/>
	</gpp:include>
	
	<type name="IP_Version">
		<iohandle>
			<std:integral subtype="4bit"/>
		</iohandle>
		<displayhandle>
			<std:enumeration>
				<std:enum_fallback>
					<std:display_integral formatstring="{:x}"/>
				</std:enum_fallback>
				<std:enumvalue mnemonic="IP_v4">
					<gpp:parsed value="0x04">
						<gpp:type_ref ref_name="integral"/>
					</gpp:parsed>
				</std:enumvalue>
				<std:enumvalue mnemonic="IP_v6">
					<gpp:parsed value="0x06">
						<gpp:type_ref ref_name="integral"/>
					</gpp:parsed>
				</std:enumvalue>
				<std:enumvalue mnemonic="IP_vMaU">
					<builtin implementor="IP_Version_Fictional"/>
				</std:enumvalue>
			</std:enumeration>
		</displayhandle>
	</type>

	<type name="IP_HL">
		<typehandle>
			<std:integral subtype="4bit" formatstring="{:d}"/>
		</typehandle>
	</type>

	<type name="IP_TOS">
		<iohandle>
			<std:integral subtype="byte"/>
		</iohandle>
		<displayhandle>
			<builtin implementor="IP_TOS"/>
		</displayhandle>
	</type>
	
	<type name="IP_Length">
		<typehandle>
			<std:integral subtype="uint16" formatstring="{:d} header quad bytes"/>
		</typehandle>
	</type>
	
	<type name="IP_ID">
		<typehandle>
			<std:integral subtype="uint16" formatstring="{:x}"/>
		</typehandle>
	</type>
	
	<type name="IP_Flags">
		<iohandle>
			<std:integral subtype="3bit"/>
		</iohandle>
		<displayhandle>
			<builtin implementor="IP_ID"/>
		</displayhandle>
	</type>
	
	<type name="IP_Frag">
		<typehandle>
			<std:integral subtype="13bit" formatstring="{:x}"/>
		</typehandle>
	</type>
	
	<type name="IP_TTL">
		<typehandle>
			<std:integral subtype="byte" formatstring="{:d}"/>
		</typehandle>
	</type>
	
	<type name="IP_Protocol">
		<iohandle>
			<std:integral subtype="byte"/>
		</iohandle>
		<displayhandle>
			<std:enumeration>
				<std:enum_fallback>
					<std:display_integral formatstring="{:x}"/>
				</std:enum_fallback>
				<std:enumvalue>
					<gpp:parsed value="4"><type_ref ref_name="integral"/></gpp:parsed>
				</std:enumvalue>
				<!-- Implement the protocol values -->
			</std:enumeration>
		</displayhandle>
	</type>
	
	<type name="IP_Checksum">
		<iohandle>
			<std:integral subtype="uint16"/>
		</iohandle>
		<displayhandle>
			<builtin implementor="IP_Checksum"></builtin>
		</displayhandle>
	</type>
	<type name="IP_Address">
		<typehandle>
			<std:integral subtype="uint32"/>
		</typehandle>
	</type>

	<packet name="IPv4">
		<field pythonname="version" type="IP_Version">
			<parsed value="IPv4"><type_ref ref_name="integral"/></parsed>
		</field>
		<field pythonname="ip_header_length" displayname="IP Header Length"
			type="IP_HL"></field>
		<field pythonname="type_of_service" displayname="Type of Service"
			type="IP_TOS"></field>
		<field pythonname="total_length" displayname="Total Length" type="IP_Length"></field>
		<field pythonname="id" displayname="Identification" type="IP_ID"></field>
		<field pythonname="flags" displayname="Flags" type="IP_Flags"></field>
		<field pythonname="fragment_offset" displayname="Fragment Offset"
			type="IP_Frag"></field>
		<field pythonname="ttl" displayname="Time to Live" type="IP_TTL"></field>
		<field pythonname="protocol" displayname="Protocol" type="IP_Protocol"></field>
		<field pythonname="checksum" displayname="Header Checksum" type="IP_Checksum"></field>
		<field pythonname="source" displayname="Source address" type="IP_Address"></field>
		<field pythonname="destination" displayname="Destination address"
			type="IP_Address"></field>
		<!-- <dynamic name="options" displayname="Options and Padding"
			type="IP_Options">
			<builtin />
		</dynamic> -->
	</packet>
</gpp:pacparse>

